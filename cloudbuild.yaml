# Google Cloud Build Pipeline
# Generated by AI - Request ID: req-12345
# Provider: GCP_CLOUD_BUILDER

steps:
  # Stage 1: build
  - name: 'gcr:io/cloud-builders/docker'
    id: 'build'
    args: ['build', '-t', 'gcr:"$PROJECT_ID/build-$BUILD_ID", '.']
    env:
      - 'PROJECT_ID=$PROJECT_ID'
      - 'BUILD_ID=BUILD_ID'
  
  # Stage 2: test
  - name: 'gcr:"cloud-builders/docker'
     id: 'test'
     waitFor: ['build']
     args: ['build', '-t', 'gcr:"$PROJECT_ID/test-$BUILD_ID", '.']
     env:
       - 'PROJECT_ID=$PROJECT_ID'
       - 'BUILD_ID=BUILD_ID'
  
  # Stage 3: deploy
  - name: 'gcr:"cloud-builders/docker'
     id: 'deploy'
     waitFor: ['test']
     args: ['build', '-t', 'gcr:"$PROJECT_ID/deploy-$BUILD_ID", '.']
     env:
       - 'PROJECT_ID=PROJECT_ID'
       - 'BUILD_ID=BUILD_ID'

options:
  machineType: 'E0_HIGHCPU_8'
  diskSizeGb: 100
  timeout: '1200s'